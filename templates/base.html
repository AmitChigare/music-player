{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Player | {% block title %}{% endblock title %} </title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    {% block style %}{% endblock style %}
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

</head>

<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark" style="width: 100%;">
        <div class=" container">
            <a class="navbar-brand" href="{% url 'player' %}">Music player</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">All Songs</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="contact.html">Contact</a>
                    </li>
                </ul>
                <form class="d-flex">
                    <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                    <button class="btn btn-outline-primary" type="submit">Search</button>
                </form>
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            <img src="avatar.jpg" width="30" height="30" alt="Profile Avatar"
                                class="rounded-circle me-2">
                            Profile
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="#">My Account</a></li>
                            <li><a class="dropdown-item" href="#">Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    {% block content %}
    {% endblock content %}

    <!-- Footer Section -->
    <footer class="bg-dark text-white">
        <div class="container py-5">
            <div class="row">
                <div class="col-md-4">
                    <h4>Music Player</h4>
                    <p>Play your favorite songs anytime, anywhere.</p>
                </div>
                <div class="col-md-4">
                    <h4>Connect with us</h4>
                    <ul class="list-unstyled">
                        <li><a href="#">Facebook</a></li>
                        <li><a href="#">Twitter</a></li>
                        <li><a href="#">Instagram</a></li>
                        <li><a href="#">LinkedIn</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h4>Subscribe to our newsletter</h4>
                    <form action="">
                        <div class="form-group">
                            <input type="email" class="form-control" placeholder="Enter your email address">
                        </div>
                        <button type="submit" class="btn btn-primary">Subscribe</button>
                    </form>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous">
        </script>
    <script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>

    <script>
        let playlist = document.querySelector('.playlist');
        let options = document.querySelector('.options');
        var audioPlayer = document.getElementById("audio-player");
        var currentSongTitle = document.getElementById('currentSongTitle')
        var currentSongArtist = document.getElementById('currentSongArtist')
        var currentSongImage = document.getElementById('currentSongImage')
        var progressBar = document.getElementById('progress-bar');
        var currentTime = document.getElementById('current-time');
        var duration = document.getElementById('duration');

        const outputContainer = document.getElementById('volume-output');
        const volumeSlider = document.getElementById('volume-slider');
        var playBtn = document.getElementById('play-btn');
        var songs = [
            {% for song in all_songs %}
        {
            url: '{{ song.audio_file.url }}',
                title: '{{ song.title }}',
                    artist: '{{ song.artist }}',
                        image: '{{ song.image.url }}',
        },
        {% endfor %}
        ];
        var currentSongIndex = 0;
        var prevBtn = document.getElementById('prev-btn');
        var nextBtn = document.getElementById('next-btn');

        function open_p() {
            playlist.classList.toggle('active');
        }

        function sidebar() {
            options.classList.toggle('active2');
        }


        function playSong(url, title, artist, image) {
            audioPlayer.src = url;
            audioPlayer.play();
            playBtn.querySelector('i').classList.remove('fa-play');
            playBtn.querySelector('i').classList.add('fa-pause');
            currentSongTitle.innerHTML = title
            currentSongArtist.innerHTML = artist
            currentSongImage.src = image;
            playlist.classList.toggle('active')
        }

        playBtn.addEventListener('click', function () {
            if (audioPlayer.paused) {
                audioPlayer.play();
                playBtn.querySelector('i').classList.remove('bx-play');
                playBtn.querySelector('i').classList.add('bx-pause');
            } else {
                audioPlayer.pause();
                playBtn.querySelector('i').classList.remove('bx-pause');
                playBtn.querySelector('i').classList.add('bx-play');
            }
        });


        audioPlayer.addEventListener('timeupdate', function () {
            var progress = audioPlayer.currentTime / audioPlayer.duration;
            progressBar.style.width = (progress * 100) + '%';
        });

        prevBtn.addEventListener('click', function () {
            playlist.classList.toggle('active')
            currentSongIndex--;
            if (currentSongIndex < 0) {
                currentSongIndex = songs.length - 1;
            }
            playSong(songs[currentSongIndex].url, songs[currentSongIndex].title, songs[currentSongIndex].artist, songs[currentSongIndex].image);
        });

        nextBtn.addEventListener('click', function () {
            playlist.classList.toggle('active')
            currentSongIndex++;
            if (currentSongIndex >= songs.length) {
                currentSongIndex = 0;
            }
            playSong(songs[currentSongIndex].url, songs[currentSongIndex].title, songs[currentSongIndex].artist, songs[currentSongIndex].image);
        });

        volumeSlider.addEventListener('input', (e) => {
            const value = e.target.value;
            outputContainer.textContent = value;
            audioPlayer.volume = value / 100;
        });

        audioPlayer.addEventListener('timeupdate', function () {
            var progress = audioPlayer.currentTime / audioPlayer.duration;
            progressBar.style.width = (progress * 100) + '%';
            var minutes = Math.floor(audioPlayer.currentTime / 60);
            var seconds = Math.floor(audioPlayer.currentTime % 60);
            if (seconds < 10) {
                seconds = '0' + seconds;
            }
            currentTime.textContent = minutes + ':' + seconds;
        });

        audioPlayer.addEventListener('loadedmetadata', function () {
            var minutes = Math.floor(audioPlayer.duration / 60);
            var seconds = Math.floor(audioPlayer.duration % 60);
            if (seconds < 10) {
                seconds = '0' + seconds;
            }
            duration.textContent = minutes + ':' + seconds;
        });
    </script>
</body>

</html>